{% extends "index.html" %}
{% load static %}
<!-- AIzaSyBatSFsLO7FcTGtpxjP7FcAwKaevJb1N_k -->
<html>
    {% block content %}
    <body>

        <h1 style="font-family: quicksand;">Map from Google</h1>
        <div id="googleMap" style="width:100%;height:400px;"></div>
        
        <head>
            <link rel="stylesheet" type="text/css" href="/static/css/get_started_bttn.css" />   
            <link rel="stylesheet" type="text/css" href="/static/css/find_route_bttn.css" />   
        </head>

        <script>
            document.addEventListener("DOMContentLoaded", load);

            var map
            var user_latitude 
            var user_longitude 
            var pos_end_dest
            var end_location
            var end_coords

            var destination = "San Francisco Twin Peaks"
            

            function load() {
                getLocation()
            }

            function getLocation() {                                        //if: successful, calls getPosition, else: gives alert//
                if (navigator.geolocation) { // Supported
                    navigator.geolocation.getCurrentPosition(getPosition) 
                } else { // Not supported
                    alert("Oops! This browser does not support HTML Geolocation.");
                }
            }

            function getPosition(position) {                                        //gets position of user from browser //
                user_latitude = position.coords.latitude;
                user_longitude = position.coords.longitude;

                const pos = {
                    lat: user_latitude,
                    lng: user_longitude,
                }

                map.setCenter(pos);
                console.log(pos)

                user_pos_marker();
                geocide();
                // end_pos_marker();

            }


            function user_pos_marker() {
                var marker1 = new google.maps.Marker({                                       //makes marker//
                    position: {
                    lat: user_latitude,
                    lng: user_longitude,
                },
                });

                marker1.setMap(map);                                                         //puts marker on map//
                console.log("set user marker")

            }

            function end_pos_marker() {

                var marker2 = new google.maps.Marker({                                       //makes marker//
                    position: end_coords,
                    
                });

                marker2.setMap(map);                                                         //puts marker on map//
                console.log("set destination marker")

            }

            function myMap() {
                
                var mapProp = {                                                             //sets properties of map//
                    center: new google.maps.LatLng(user_latitude, user_longitude),
                    zoom: 13,
                };

                map = new google.maps.Map(document.getElementById("googleMap"), mapProp);   //makes map//
                
            }

            function geocide() {
                var geocoder = new google.maps.Geocoder()

                geocoder.geocode(
                    {
                        address: destination,
                    },
                    function(results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            end_location = results[0].geometry.location

                            lat = end_location.lat()
                            lng = end_location.lng()
                            
                            end_coords = {
                                lat,
                                lng,
                            };
                        }
                        else {
                            console.log("geocode failed")
                        }
                    },
                );      

                console.log(end_coords)
                console.log("geocide achieved")
            }


            function calcRoute() {         
                var directionsService = new google.maps.DirectionsService();
                var directionsDisplay = new google.maps.DirectionsRenderer();            //calculates route??//

                geocide();

                var start = {
                    lat: user_latitude,
                    lng: user_longitude,
                }
                var end = end_coords;

                var request = {                                                         // route calculating options//
                    origin: start,
                    destination: end,
                    travelMode: 'TRANSIT',  //can replace transit with var//
                    unitSystem: google.maps.UnitSystem.IMPERIAL,

                };

                
                console.log("calcroute called")

                directionsService.route(request, function(result, status) {
                    if (status == 'OK') {
                    console.log("directions");
                    directionsDisplay.setMap(map);
                    directionsDisplay.setDirections(result);                            //displays directions?? //
                    }
                    else {
                        console.log("directions failed");
                    }
                });
                
            }

        </script>

        <!-- gets info from google -->
        <script 
        src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBatSFsLO7FcTGtpxjP7FcAwKaevJb1N_k&callback=myMap" 
        type="text/javascript"
        >
        </script>

        <!-- <script 
        src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBatSFsLO7FcTGtpxjP7FcAwKaevJb1N_k&callback=calcRoute" 
        type="text/javascript"
        >
        </script> -->


        <!-- calculates route when button is pressed -->  
        <div class="btn find_r_container"> 
            <button type="button" onclick="calcRoute()" class="btn find_r_button">Find your route</button>
        </div>
    </body>

    {% endblock content %}
</html>